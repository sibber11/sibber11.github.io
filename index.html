<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <input type="text" name="" id="inputText">
  <main id="main"></main>
</body>

</html>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script type="module">

  function convert(input) {
    let out = '';
    for (const letter in input) {
      out += '0' + input.charCodeAt(letter).toString(2);
    }
    return out + out[out.length - 1];
  }
  const main = document.getElementById('main');
  const input = document.getElementById('inputText');
  const signals = ['nrz', 'nrzl', 'nrzi', 'manchester'];
  let charts = [];
  const voltage = 2;
  const avgVoltage = voltage / 2;

  const config = {
    type: 'line',
    data: {
      labels: [0, 0, 1, 1],
      datasets: [{
        label: '',
        data: []
      }],
      stepped: true,
      pointStyle: false
    },
    options: {
      scale: {
        y: {
          min: -voltage * 1.5,
          max: voltage * 1.5
        }
      }
    },
  };
  const lineEncoding = {
    nrz: function (bits) {
      let out = [];
      for (const bit of bits) {
        if (bit == 1) {
          out.push(voltage)
        } else {
          out.push(0);
        }
      }
      return out;
    },
    nrzl: function (bits) {
      let out = [];
      for (const bit of bits) {
        const volt = (bit == 1) ? -avgVoltage : avgVoltage;
        out.push(volt);
      }
      return out;
    },
    nrzi: function (bits) {
      let out = [];
      for (const bit of bits) {
        if (bit == 1 && out[out.length - 1] > 0) {
          out.push(-avgVoltage)
        } else {
          out.push(avgVoltage);
        }
      }
      return out;
    },
    manchester: function (bits) {
      let out = [];
      for (const bit of bits) {
        if (bit == 1) {
          out.push(avgVoltage);
          out.push(-avgVoltage);
        } else {
          out.push(-avgVoltage);
          out.push(avgVoltage);
        }
      }
      return out;
    }
  }

  const lineEncodingLabels = {
    manchester: function (bits) {
      let out = [];
      for(const bit of bits){
        out.push(bit,bit);
      }
      return out;
    }
  }
  function getData(keyName, bits) {
    if (bits == undefined) {
      return [];
    }
    return lineEncoding[keyName](bits);
  }
  function getLabels(keyName, bits) {
    if (bits == undefined) {
      return [];
    }
    if (!lineEncodingLabels[keyName]) {
      return bits;
    }
    return lineEncodingLabels[keyName](bits);
  }
  signals.forEach(el => {
    let ctx = document.createElement('canvas');
    // ctx.setAttribute('id', el);
    main.appendChild(ctx);
    let localConfig = JSON.parse(JSON.stringify(config));
    const bits = convert(input.value);
    localConfig.data.labels = bits;
    localConfig.data.datasets = [{
      label: el,
      data: bits,
      stepped: true
    }]
    charts.push({ [el]: new Chart(ctx, localConfig) });
  });
  function update() {
    const bits = convert(input.value);
    charts.forEach((el, value) => {
      const keyName = Object.keys(el)[0];
      const chart = el[keyName];
      chart.data.labels = getLabels(keyName, bits);
      chart.data.datasets = [{
        label: keyName,
        data: getData(keyName, bits),
        stepped: true
      }];
      chart.update();
    })
  }


  input.oninput = update;
</script>
